---
output: github_document
bibliography: bib.bib
link-citations: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

fake_data <- function (seed,n) {
	set.seed(seed)
	X1 = runif(n)
	XA = X1*runif(n)
	X2 = runif(n)
	XB = X2*runif(n)
	X3 = runif(n)
	Z1 = runif(n)
	ZA = Z1*runif(n)
	Z2 = runif(n)
	ZB = Z2*runif(n)
	Z3 = runif(n)
	ZC = Z3*runif(n)
	D1 = XA + 5*ZA +ZB
	D2 = XB + 2*ZB + ZC
	Y = XB + D1*2*runif(n) + D2*runif(n)
	data.frame(X1,X2,X3,Z1,Z2,Z3,Y,D1,D2)
}
example_data <- fake_data(40,1000)

```

# Cragg
An R package to implement the Cragg-Donald test for weak instruments.

[![Build Status](https://travis-ci.com/beniaminogreen/cragg.svg?branch=main)](https://travis-ci.com/beniaminogreen/cragg)
![Codecov](https://img.shields.io/codecov/c/github/beniaminogreen/cragg)
[![License: GPL v3](https://img.shields.io/badge/License-GPL%20v3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0.en.html)

## Overview
The Cragg-Donald [-@Cragg_1993] test is a common way to test for weak instruments in an IV regeression but has never been implemented in R.
The cragg package provides an implementation of the Cragg-Donald test in R and provides access to the critical values for the Cragg-Donald statistic developed in Stock and Yogo [-@Stock_2005].
These tests quantify the degree to which weak instruments can undermine regression estimates for models with multiple endogenous variables / treatments.

### Main Features

* Calculates Cragg-Donald statistics for weak instruments.

* Recommends critical values for the Cragg-Donald Statistic based on the largest allowable bias relative to regular OLS
  or the maximum allowable size distortion of the Wald test statistic.

## Installation
```{r, eval = FALSE}
#install.packages("devtools")
devtools::install_github("beniaminogreen/cragg")
```

## Usage
The cragg package has two main functions `cragg_donald()`,  and `stock_yogo_test()`.

`cragg_donald()` implements the Cragg-Donald test for weak instruments in R. It can be thought of
as the matrix-equivalent of the first-stage F-test for weak instruments, and is used to evaluate models
with multiple endogenous variables. This function has been tested against the results from STATA's ivreg2 package [@ivreg2] to ensure accuracy.
The syntax is show below:

```{r}
library(cragg)
#Cragg-Donald Test
cragg_donald(
	~X1+X2+X3,	#Controls
	~D1 + D2,			#Treatments
	~Z1 + Z2 + Z3,	#Instruments
	data =example_data
)
```
`stock_yogo_test()` implements the Stock and Yogo test for weak instruments. The test developed by Stock and Yogo [-@Stock_2005]
is a decision rule meant to ensure that weak instruments do not pose a problem.
Stock and Yogo suggest two methods to select the critical values: one based on maximum allowable bias relative to normal OLS and another based on the maximum size of a Wald test on all of the instruments.
Both of these decision rules are implemented.

```{r}
stock_yogo_test(
	~X1+X2+X3,	#Controls
	~D1,			#Treatments
	~Z1 + Z2,	#Instruments
	B=.1,		#Maximum Allowable Size Distortion
	size_bias="size", #Calculate critical value for size distortions
	data =example_data
)
```

# References
